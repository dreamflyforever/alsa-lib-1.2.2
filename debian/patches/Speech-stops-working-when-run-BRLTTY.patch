From: Sebastian Humenda <shumenda@gmx.de>
Date: Wed, 10 Aug 2016 20:30:25 +0200
Subject: [PATCH] Speech stops working after roughly a minute when running
 BRLTTY. Add a thread_safe

---
 src/pcm/pcm.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/pcm/pcm.c b/src/pcm/pcm.c
index f832399..1d8ece3 100644
--- a/src/pcm/pcm.c
+++ b/src/pcm/pcm.c
@@ -2544,6 +2544,7 @@ int snd_pcm_new(snd_pcm_t **pcmp, snd_pcm_type_t type, const char *name,
 	pcm->fast_op_arg = pcm;
 	INIT_LIST_HEAD(&pcm->async_handlers);
 #ifdef THREAD_SAFE_API
+	pcm->thread_safe = 1;
 	pthread_mutex_init(&pcm->lock, NULL);
 	{
 		static int default_thread_safe = -1;
-- 
2.8.1

